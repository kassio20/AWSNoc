<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SelectNOC IA - Advanced AWS Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-number.healthy { color: #10B981; }
        .stat-number.warning { color: #F59E0B; }
        .stat-number.critical { color: #EF4444; }
        .stat-number.info { color: #3B82F6; }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .panel h2 {
            margin-bottom: 20px;
            color: #1F2937;
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 10px;
        }

        .alert-item {
            background: #FEF2F2;
            border-left: 4px solid #EF4444;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .alert-item:hover {
            background: #FEE2E2;
        }

        .alert-item.medium {
            background: #FEFBF2;
            border-left-color: #F59E0B;
        }

        .alert-item.low {
            background: #F0F9FF;
            border-left-color: #3B82F6;
        }

        .alert-title {
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 5px;
        }

        .alert-description {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .alert-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #9CA3AF;
        }

        .severity-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .severity-high { background: #FEE2E2; color: #DC2626; }
        .severity-medium { background: #FEF3C7; color: #D97706; }
        .severity-low { background: #DBEAFE; color: #2563EB; }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #E5E7EB;
            transition: background-color 0.3s ease;
        }

        .resource-item:hover {
            background: #F9FAFB;
        }

        .resource-item:last-child {
            border-bottom: none;
        }

        .resource-type {
            font-weight: 600;
            color: #1F2937;
        }

        .resource-count {
            background: #F3F4F6;
            color: #374151;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .health-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .healthy { background: #10B981; }
        .warning { background: #F59E0B; }
        .critical { background: #EF4444; }
        .unknown { background: #6B7280; }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            color: #6B7280;
            font-style: italic;
        }

        .discovery-status {
            background: #F0F9FF;
            border: 1px solid #BAE6FD;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .ai-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SelectNOC IA</h1>
            <p>AI-Powered AWS Resource Monitoring & Discovery</p>
        </div>

        <div class="discovery-status">
            <strong>üîç Advanced Resource Discovery:</strong> 
            <span id="discovery-info">Comprehensive scanning across 16+ AWS services with real-time health monitoring</span>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number info" id="total-resources">-</div>
                <div>Total Resources</div>
            </div>
            <div class="stat-card">
                <div class="stat-number healthy" id="healthy-resources">-</div>
                <div>Healthy Resources</div>
            </div>
            <div class="stat-card">
                <div class="stat-number critical" id="active-alerts">-</div>
                <div>Active Alerts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number info" id="resource-types">-</div>
                <div>Resource Types</div>
            </div>
        </div>

        <button class="refresh-btn" onclick="refreshData()" id="refresh-btn">
            üîÑ Refresh Discovery
        </button>

        <div class="content-grid">
            <div class="panel">
                <h2>üö® Active Alerts <span class="ai-badge">AI-Powered</span></h2>
                <div class="loading" id="alerts-loading">Loading alerts...</div>
                <div id="alerts-container">
                    <p style="color: #6B7280; text-align: center; padding: 20px;">Loading alerts...</p>
                </div>
            </div>

            <div class="panel">
                <h2>üìä Resource Discovery</h2>
                <div class="loading" id="resources-loading">Discovering resources...</div>
                <div id="resources-container">
                    <p style="color: #6B7280; text-align: center; padding: 20px;">Loading resources...</p>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>üîç Latest Discovery Results</h2>
            <div id="discovery-log">
                <p style="color: #6B7280; text-align: center; padding: 20px;">Discovery log will appear here...</p>
            </div>
        </div>
    </div>

    <script>
        let currentAccount = null;
        let refreshing = false;

        async function loadAccounts() {
            try {
                const response = await fetch('/api/v1/accounts');
                const data = await response.json();
                
                if (data.accounts && data.accounts.length > 0) {
                    currentAccount = data.accounts[0];
                    document.getElementById('discovery-info').textContent = 
                        \`Account: \${currentAccount.name} (\${currentAccount.account_id}) - Region: \${currentAccount.region}\`;
                    await loadMonitoringData();
                    await loadAlerts();
                    await loadResourceSummary();
                } else {
                    document.getElementById('discovery-info').textContent = 'No AWS accounts configured. Please add an account first.';
                }
            } catch (error) {
                console.error('Error loading accounts:', error);
                document.getElementById('discovery-info').textContent = 'Error loading account information';
            }
        }

        async function loadMonitoringData() {
            if (!currentAccount) return;

            try {
                const response = await fetch(\`/api/v1/accounts/\${currentAccount.id}/monitoring\`);
                const data = await response.json();

                document.getElementById('total-resources').textContent = data.total_resources || 0;
                document.getElementById('healthy-resources').textContent = data.health_status?.healthy || 0;
                document.getElementById('active-alerts').textContent = data.active_alerts || 0;
                document.getElementById('resource-types').textContent = Object.keys(data.resource_counts || {}).length;

                // Update discovery log
                const logContainer = document.getElementById('discovery-log');
                logContainer.innerHTML = \`
                    <div style="font-family: monospace; background: #F9FAFB; padding: 15px; border-radius: 8px;">
                        <div><strong>Last Discovery:</strong> \${new Date(data.last_check).toLocaleString()}</div>
                        <div><strong>Resources Found:</strong> \${data.total_resources}</div>
                        <div><strong>Health Status:</strong> 
                            <span class="health-indicator healthy"></span>\${data.health_status?.healthy || 0} Healthy, 
                            <span class="health-indicator warning"></span>\${data.health_status?.warning || 0} Warning, 
                            <span class="health-indicator critical"></span>\${data.health_status?.critical || 0} Critical,
                            <span class="health-indicator unknown"></span>\${data.health_status?.unknown || 0} Unknown
                        </div>
                        <div><strong>Alert Distribution:</strong> 
                            \${data.alert_counts?.critical || 0} Critical, 
                            \${data.alert_counts?.high || 0} High, 
                            \${data.alert_counts?.medium || 0} Medium, 
                            \${data.alert_counts?.low || 0} Low
                        </div>
                    </div>
                \`;

            } catch (error) {
                console.error('Error loading monitoring data:', error);
            }
        }

        async function loadAlerts() {
            if (!currentAccount) return;

            try {
                document.getElementById('alerts-loading').style.display = 'block';
                const response = await fetch(\`/api/v1/accounts/\${currentAccount.id}/alerts\`);
                const data = await response.json();

                const container = document.getElementById('alerts-container');
                document.getElementById('alerts-loading').style.display = 'none';

                if (data.alerts && data.alerts.length > 0) {
                    container.innerHTML = data.alerts.map(alert => \`
                        <div class="alert-item \${alert.severity}">
                            <div class="alert-title">\${alert.title}</div>
                            <div class="alert-description">\${alert.description}</div>
                            <div class="alert-meta">
                                <span>
                                    <span class="health-indicator \${alert.severity === 'high' ? 'critical' : alert.severity === 'medium' ? 'warning' : 'info'}"></span>
                                    \${alert.resource_type} ‚Ä¢ \${alert.alert_type}
                                </span>
                                <span class="severity-badge severity-\${alert.severity}">\${alert.severity}</span>
                            </div>
                        </div>
                    \`).join('');
                } else {
                    container.innerHTML = '<p style="color: #10B981; text-align: center; padding: 20px;">‚úÖ No active alerts - All systems healthy!</p>';
                }
            } catch (error) {
                console.error('Error loading alerts:', error);
                document.getElementById('alerts-container').innerHTML = '<p style="color: #EF4444; text-align: center; padding: 20px;">Error loading alerts</p>';
                document.getElementById('alerts-loading').style.display = 'none';
            }
        }

        async function loadResourceSummary() {
            if (!currentAccount) return;

            try {
                document.getElementById('resources-loading').style.display = 'block';
                const response = await fetch(\`/api/v1/accounts/\${currentAccount.id}/monitoring\`);
                const data = await response.json();

                const container = document.getElementById('resources-container');
                document.getElementById('resources-loading').style.display = 'none';

                if (data.resource_counts && Object.keys(data.resource_counts).length > 0) {
                    const sortedResources = Object.entries(data.resource_counts)
                        .sort(([,a], [,b]) => b - a);

                    container.innerHTML = sortedResources.map(([type, count]) => \`
                        <div class="resource-item">
                            <span class="resource-type">\${type.replace('_', ' ')}</span>
                            <span class="resource-count">\${count}</span>
                        </div>
                    \`).join('');
                } else {
                    container.innerHTML = '<p style="color: #6B7280; text-align: center; padding: 20px;">No resources discovered yet</p>';
                }
            } catch (error) {
                console.error('Error loading resource summary:', error);
                document.getElementById('resources-container').innerHTML = '<p style="color: #EF4444; text-align: center; padding: 20px;">Error loading resources</p>';
                document.getElementById('resources-loading').style.display = 'none';
            }
        }

        async function refreshData() {
            if (!currentAccount || refreshing) return;

            refreshing = true;
            const btn = document.getElementById('refresh-btn');
            btn.disabled = true;
            btn.textContent = 'üîÑ Refreshing...';

            try {
                // Trigger resource refresh
                await fetch(\`/api/v1/accounts/\${currentAccount.id}/resources/refresh\`, {
                    method: 'POST'
                });

                // Wait a bit for background processing
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Reload all data
                await loadMonitoringData();
                await loadAlerts();
                await loadResourceSummary();

                btn.textContent = '‚úÖ Refreshed!';
                setTimeout(() => {
                    btn.textContent = 'üîÑ Refresh Discovery';
                    btn.disabled = false;
                    refreshing = false;
                }, 2000);

            } catch (error) {
                console.error('Error refreshing data:', error);
                btn.textContent = '‚ùå Error';
                setTimeout(() => {
                    btn.textContent = 'üîÑ Refresh Discovery';
                    btn.disabled = false;
                    refreshing = false;
                }, 2000);
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (!refreshing) {
                loadMonitoringData();
                loadAlerts();
            }
        }, 30000);

        // Initial load
        loadAccounts();
    </script>
</body>
</html>
